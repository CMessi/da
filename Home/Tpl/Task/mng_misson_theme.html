<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="description" content="">
<meta name="author" content="">
<title>大数据监测指挥中心 - 数据分析平台</title>

<!-- Bootstrap Core CSS -->
<link href="__PUBLIC__/bower_components/bootstrap/dist/css/bootstrap.min.css" rel="stylesheet">

<!-- MetisMenu CSS -->
<link href="__PUBLIC__/bower_components/metisMenu/dist/metisMenu.min.css" rel="stylesheet">

<!-- Custom CSS -->
<link href="__PUBLIC__/dist/css/sb-admin-2.css" rel="stylesheet">
<!-- DataTables CSS -->
<link href="__PUBLIC__/bower_components/datatables-plugins/integration/bootstrap/3/dataTables.bootstrap.css" rel="stylesheet">

<!-- DataTables Responsive CSS -->
<link href="__PUBLIC__/bower_components/datatables-responsive/css/dataTables.responsive.css" rel="stylesheet">

<!-- Custom Fonts -->
<link href="__PUBLIC__/bower_components/font-awesome/css/font-awesome.min.css" rel="stylesheet" type="text/css">

<!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
<!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
<!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->

</head>

<body>
<div id="wrapper">

  <nav class="navbar navbar-default navbar-static-top" role="navigation" style="margin-bottom: 0">
      <include file="Public:header" />
      <!-- /.navbar-top-links -->
      <div class="navbar-default sidebar" role="navigation" id="menu">
          <include file="Public:menu" />
      <!-- /.navbar-static-side -->
      </div>
  </nav>

<!-- Page Content -->
<div id="page-wrapper">
<div class="container-fluid">
  <div class="row">
    <div class="col-lg-12">
      <h1 class="page-header">任务管理 - <?php echo $_GET['kwds'];?> 
      <!-- <a href="__URL__/mng_misson_analysis_theme?id=<?php //echo $_GET['id'];?>&kwds=<?php //echo $_GET['kwds'];?>">
          <button type="button" class="btn btn-default " >主题管理</button>
        </a> -->  
<button type="button" class="btn btn-default " data-toggle="modal" data-target="#myModal">主题管理</button>

        </h1>
    </div>
    <!-- /.col-lg-12 --> 
  </div>
 
  <div class="dataTable_wrapper">
   
        <div class="row">
		
                  <div class="col-sm-12">
                    <table class="table table-striped table-bordered table-hover dataTable no-footer" id="dataTables-example" role="grid" aria-describedby="dataTables-example_info">
                      <thead>
                        <tr role="row">
                          <th   rowspan="1" style="width: 100px;" ><input type="checkbox" name="checkbox" id="checkbox">
                            全选</th>
                          <th   rowspan="1" colspan="1" style="width: 180px;" >主题名称</th>
                          <th rowspan="1" colspan="1" style="width: 180px;">分类名称</th>
                          <th rowspan="1" style="width: 200px;">操作</th>
                        </tr>
                      </thead>
                      <tbody>
                      <foreach name="list" item="v">
                        <tr class="gradeA odd" role="row">
                          <td class="sorting_1"><span style="width: 180px;">
                            <input type="checkbox" name="checkbox2" id="checkbox2">
                          </span></td>
                          <td class="sorting_1"><{$v.name}></td>
                          <td><{$v.cname}></td>
                          <td class="center">
                        
                          <!-- <a href="http://www.lvyoudashuju.com/da/index.php/task/task_detail?id=1&kwds=房产">
                          <button type="button" class="btn btn-outline btn-primary btn-xs">修改</button>
                          </a> -->
                          <!-- <button type="button" class="btn btn-outline btn-primary btn-xs" onclick="del()">删除</button>
                                                     -->

                          <button type="button" class="btn btn-primary" data-toggle="modal" onclick="showSetTheme(<{$v.id}>,'<{$v.task_name}>')" data-target="#myModal2">设置主题</button>



                          <!-- <a href="__URL__/mng_misson_analysis_Category">
                          <button type="button" class="btn btn-outline btn-primary btn-xs">分类</button>
                          </a> -->
                          
                          </td>
                        </tr>
                      </foreach>
                      </tbody>
                    </table>
                  </div>
        </div>
        <!-- /.panel --> 
   
    
<!--     <div class="row">
  <div class="col-sm-6">
    <div class="dataTables_info" id="dataTables-example_info" role="status" aria-live="polite">共57条记录 当前第1至10条记录</div>
  </div>
  <div class="col-sm-6">
    <div class="dataTables_paginate paging_simple_numbers" id="dataTables-example_paginate">
      <ul class="pagination">
        <li class="paginate_button previous disabled" aria-controls="dataTables-example" tabindex="0" id="dataTables-example_previous"><a href="#">上一页</a></li>
        <li class="paginate_button active" aria-controls="dataTables-example" tabindex="0"><a href="#">1</a></li>
        <li class="paginate_button " aria-controls="dataTables-example" tabindex="0"><a href="#">2</a></li>
        <li class="paginate_button " aria-controls="dataTables-example" tabindex="0"><a href="#">3</a></li>
        <li class="paginate_button " aria-controls="dataTables-example" tabindex="0"><a href="#">4</a></li>
        <li class="paginate_button " aria-controls="dataTables-example" tabindex="0"><a href="#">5</a></li>
        <li class="paginate_button " aria-controls="dataTables-example" tabindex="0"><a href="#">6</a></li>
        <li class="paginate_button next" aria-controls="dataTables-example" tabindex="0" id="dataTables-example_next"><a href="#">下一页</a></li>
      </ul>
    </div>
  </div>
</div> -->
    <div> 
      
      <!-- /.row --> 
    </div>
    <!-- /.container-fluid --> 
  </div>
  <!-- /#page-wrapper --> 
  
</div>
<!-- /#wrapper --> 

<!-- jQuery --> 

      <div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" >
                                <div class="modal-dialog">
                                    <div class="modal-content">
                                        <div class="modal-header">
                                            <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                                            <h4 class="modal-title" id="myModalLabel">任务分类管理 <button type="button" class="btn btn-outline btn-primary btn-xs" data-toggle="modal" data-target="#myModal3">新建</button></h4>
                                        </div>
                                        <div class="modal-body">
                                            <div class="row"><div class="col-sm-12"><table class="table table-striped table-bordered table-hover dataTable no-footer" id="dataTables-example" role="grid" aria-describedby="dataTables-example_info">
                                    <thead>
                                        <tr role="row">
                                          <th   rowspan="1" style="width: 175px;" >排序</th>
                                          <th   rowspan="1" colspan="1" style="width: 175px;" >分类名称</th>
                                        <th rowspan="1" style="width: 109px;">操作</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                      <foreach name="task_themes" item="v">
                                      <tr class="gradeA odd" role="row" id="list_<{$v.id}>">
                                        <td class="sorting_1"><{$v.id}></td>
                                              <td class="sorting_1"><{$v.name}></td>
                                              <td class="center"><button type="button" class="btn btn-outline btn-primary btn-xs" data-toggle="modal" data-target="#myModal4" onclick="showUpdateTheme(<{$v.id}>,'<{$v.name}>')">修改</button>  <button type="button" class="btn btn-outline btn-primary btn-xs" onclick="del(<{$v.id}>)">删除</button></td>
                                      </tr>
                                      </foreach>                                    
                                    </tbody>
                                </table></div></div>
                                        </div>
                                        <div class="modal-footer">
                                            <button type="button" class="btn btn-primary" data-dismiss="modal">关闭</button>
                                        </div>
                                    </div>
                                    <!-- /.modal-content -->
                                </div>
                                <!-- /.modal-dialog -->
                            </div>



        <div class="modal fade" id="myModal2" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
                                <div class="modal-dialog">
                                    <div class="modal-content">
                                        <div class="modal-header">
                                            <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                                            <h4 class="modal-title" id="myModalLabel">任务主题管理 </h4>
                                        </div>
                                        <div class="modal-body">
                                            <div class="row">
                                              <div class="col-sm-12"><table class="table table-striped table-bordered table-hover dataTable no-footer" id="dataTables-example" role="grid" aria-describedby="dataTables-example_info">
                                    <thead>
                                        <tr role="row">
                                          <th   rowspan="1" style="width: 175px;" >任务名称</th>
                                          <th   rowspan="1" colspan="1" style="width: 175px;" >所属主题</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                       
                                    <tr class="gradeA odd" role="row">
                                      <td class="sorting_1" id="taskName"></td>
                                      <td style="display:none" id="taskId"></td>
                                            <td class="sorting_1"><select class="form-control" id="setName">
                                            <foreach name="task_themes" item="v">
                                              <option value="<{$v.id}>"><{$v.name}></option>
                                              </foreach>
                                            </select></td>
                                        </tr>
                                    </tbody>
                                </table></div></div>
                                        </div>
                                        <div class="modal-footer">
                                            <button type="button" class="btn btn-primary" data-dismiss="modal" onclick="saveSetCaegory()">保存</button>
                                        </div>
                                    </div>
                                    <!-- /.modal-content -->
                                </div>
                                <!-- /.modal-dialog -->
                            </div>
<!--添加主题-->
        <div class="modal fade" id="myModal3" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
                                <div class="modal-dialog">
                                    <div class="modal-content">
                                        <div class="modal-header">
                                            <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                                            <h4 class="modal-title" id="myModalLabel">添加任务主题 </h4>
                                        </div>
                                        <div class="modal-body">
                                            <div class="row">
                                              <div class="col-sm-12"><table class="table table-striped table-bordered table-hover dataTable no-footer" id="dataTables-example" role="grid" aria-describedby="dataTables-example_info">
                                    <thead>
                                        <tr role="row">
                                          
                                          <th   rowspan="1" colspan="1" style="width: 175px;" >主题名称      <input type="text" id="addCategoryName"></th>
                                          
                                        </tr>
                                    </thead>
                                </table></div></div>
                                        </div>
                                        <div class="modal-footer">
                                            <button type="button" class="btn btn-primary" data-dismiss="modal" onclick="AddSetTheme()">保存</button>
                                        </div>
                                    </div>
                                    <!-- /.modal-content -->
                                </div>
                                <!-- /.modal-dialog -->
                            </div>

        <div class="modal fade" id="myModal4" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
                                <div class="modal-dialog">
                                    <div class="modal-content">
                                        <div class="modal-header">
                                            <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                                            <h4 class="modal-title" id="myModalLabel">修改任务主题</h4>
                                        </div>
                                        <div class="modal-body">
                                            <div class="row">
                                              <div class="col-sm-12"><table class="table table-striped table-bordered table-hover dataTable no-footer" id="dataTables-example" role="grid" aria-describedby="dataTables-example_info">
                                    <thead>
                                    <td style="display:none" id="categoryId"></td>
                                        <tr role="row">
                                          
                                          <th   rowspan="1" colspan="1" style="width: 175px;" >修改主题名称      <input type="text" id="upCategoryName"></th>
                                          
                                        </tr>
                                    </thead>
                                </table></div></div>
                                        </div>
                                        <div class="modal-footer">
                                            <button type="button" class="btn btn-primary" data-dismiss="modal" onclick="updateTheme()">保存</button>
                                        </div>
                                    </div>
                                    <!-- /.modal-content -->
                                </div>
                                <!-- /.modal-dialog -->
                            </div>

<script src="__PUBLIC__/bower_components/jquery/dist/jquery.min.js"></script> 

<!-- Bootstrap Core JavaScript --> 
<script src="__PUBLIC__/bower_components/bootstrap/dist/js/bootstrap.min.js"></script> 

<!-- Metis Menu Plugin JavaScript --> 
<script src="__PUBLIC__/bower_components/metisMenu/dist/metisMenu.min.js"></script> 

<!-- Custom Theme JavaScript --> 
<script src="__PUBLIC__/dist/js/sb-admin-2.js"></script>
</body>
<script>
      //加载菜单栏
      $(function(){
        $.post('__APP__/common/ajaxGetMenu',function(data){
          $("#menu").html(data);
          $("#menu ul li ul li a ").removeClass("active");
          var c = "<?php echo MODULE_NAME.ACTION_NAME; ?>";
          var d = "<?php echo MODULE_NAME?>";
          //$('#menu ul li .'+d+'').addClass("active");
          $('#menu ul li ul li .'+c+'').addClass("active");
          $('#menu ul li ul li .'+c+'').parent().parent().addClass("in");
          $('#menu ul li ul li .'+c+'').parent().parent().attr("aria-expanded","true");

        })
      })
//删除主题
      function del(id){
        //var id = "<?php echo $_GET[id]?>";
        $.post("__URL__/ajaxDelTheme",{id:id},function(data){
          if(data=='ok'){
            alert("删除成功");
            location.reload();
          }else{
            alert("删除失败");return false;
          }
        })
      }


//保存设置主题 
      function showSetTheme(id,name){
        $("#taskName").html(name);
        $("#taskId").html(id);

      }
      function saveSetCaegory(){
        var taskId = $("#taskId").html();
        var setName = $("#setName").val();
        $.post("__URL__/ajaxSaveSetTheme",{taskId:taskId,setName:setName},function(data){
          if(data=='ok'){
            alert("修改成功");location.reload();
          }else{
            alert("修改失败");return false;
          }
        })
      }



//添加分类

      function AddSetTheme(){
        var name = $("#addCategoryName").val();
        if(name==''){
          alert("添加失败");return false;
        }
         $.post("__URL__/ajaxAddTheme",{name:name},function(data){
           if(data=='ok'){
             alert("添加成功");location.reload();
           }else{
             alert("添加失败");return false;
           }
         })       
      }

//修改主题名称
      function showUpdateTheme(id,name){
        $("#myModalLabel").html(name);
        $("#categoryId").html(id);

      }
      function updateTheme(){
        var categoryId = $("#categoryId").html();
        var upCategoryName = $("#upCategoryName").val();
        $.post("__URL__/ajaxUpdateTheme",{themeId:categoryId,upThemeName:upCategoryName},function(data){
          if(data=='ok'){
            alert("修改成功");location.reload();
          }else{
            alert("修改失败");return false;
          }
        })
      }


</script>
</html>
